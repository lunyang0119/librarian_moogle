# Librarian Moogle - Discord RPG Battle System

Discord 봇 기반의 턴제 RPG 전투 시스템입니다. Google Sheets를 데이터베이스로 활용하여 캐릭터 정보와 전투 데이터를 관리합니다.

## 📋 **현재 구현된 기능**

### **1. 캐릭터 관리 시스템**
- ✅ `/내스탯` - 캐릭터 스탯 조회
- ✅ `/시트업뎃` - Google Sheets 데이터 새로고침
- ✅ 캐릭터 등록 및 스탯 관리
- ✅ 직업 시스템 (tank, healer, melee, ranged, magic)

### **2. 전투 준비 시스템**
- ✅ `/전투준비 [그룹]` - 전투 그룹 생성 및 초기화 (A/B/boss)
- ✅ `/전투참가 [그룹]` - 전투 그룹 참가
- ✅ `/준완 [그룹]` - 전투 시작 및 턴 순서 결정
- ✅ 턴 순서 자동 배정 (주사위 기반)

### **3. 전투 UI 시스템**
- ✅ `/행동` - 전투 액션 버튼 인터페이스
- ✅ **BattleInteraction** - 공격/방어/스킬 선택 버튼
- ✅ **SkillInteraction** - 스킬1/스킬2/리미트브레이크 선택
- ✅ **AttackTargetSelect** - 공격 대상 선택
- ✅ **SkillTargetSelect** - 스킬 대상 선택 (단일/전체/아군/적)

### **4. 데이터 관리 시스템**
- ✅ Google Sheets 연동 (`gspread_manager.py`)
- ✅ 캐릭터 데이터 CRUD 작업
- ✅ 전투 그룹 데이터 관리
- ✅ 적 데이터 관리

### **5. 유틸리티 시스템**
- ✅ 주사위 굴리기 (`utility.py`)
- ✅ 대인행동/일반행동/전투행동/책찾기 랜덤 이벤트
- ✅ 로깅 시스템

## 🚧 **부분 구현된 기능**

### **1. 전투 로직**
- 🟡 공격 성공 판정 로직 (`BattleSystem.user_atk_success_roll`)
- 🟡 피해 계산 (`BattleSystem.user_raw_damage`)
- 🟡 직업별 스킬 로직 (`Job.user_skill1_logic`)
- 🟡 사용자-적 전투 판정 (`Job.comp_user_enemy_throw`)

### **2. 턴 관리 시스템**
- 🟡 턴 진행 관리 (`BattleSystem.user_turn_manager`)
- 🟡 행동 완료 체크 (`Character.all_act`)

## ❌ **미구현 기능**

### **1. 핵심 전투 시스템**
- ❌ **실제 전투 판정 로직** - 공격/스킬 사용 시 실제 데미지 계산 및 적용
- ❌ **전투 로그 시스템** - 전투 진행 상황 기록 및 표시
- ❌ **턴 종료 처리** - 모든 참가자 행동 완료 시 다음 턴 진행
- ❌ **승리/패배 조건 판정** - HP 0 체크 및 전투 종료

### **2. 상태 관리 시스템**
- ❌ **상태이상 시스템** - 출혈, 마비, 석화, 발화 등
- ❌ **버프/디버프 관리** - 스킬 효과 지속시간 관리
- ❌ **HP 관리 시스템** - 실시간 HP 증감 및 표시

### **3. 스킬 시스템**
- ❌ **직업별 스킬 구현**
  - Tank: 대신받기, 무적화
  - Healer: 단일/전체 회복
  - Melee: 강화 공격
  - Ranged: 출혈 부여, 광역 공격
  - Magic: 마비 부여, 지연 공격
- ❌ **리미트 브레이크 시스템**
- ❌ **스킬 사용 제한 관리** (전투당 1회)

### **4. PVP 시스템**
- ❌ **PVP 매칭 시스템** - 1vs1, 3vs3 대기열
- ❌ **PVP 전투 로직** - 플레이어 간 전투
- ❌ **코인 시스템** - 승리 보상 및 코인 관리
- ❌ `/코인보유량` 명령어

### **5. 고급 기능**
- ❌ **전투 난입 시스템** - 진행 중인 전투에 참가
- ❌ **보상 시스템** - 승리 시 소재 획득
- ❌ **상점 시스템** - 아이템 구매/판매
- ❌ **인벤토리 시스템** - 아이템 관리

### **6. 관리자 기능**
- ❌ **관리자 명령어들**
  - `/굿차`, `/밷차` - 팀 HP 조정
  - `/뿅 [적이름]` - 적 즉시 처치
  - `/헬프미모그` - 아군 지속 회복
  - `/가라 [적ID]` - 적 제외

## 🔧 **주요 수정 필요사항**

### **1. 구조적 문제**
- **메서드 호출 오류** - `self` 파라미터 오류들 수정 필요
- **비동기 처리 일관성** - async/await 사용 통일
- **에러 처리 개선** - 예외 상황 체계적 처리

<<<<<<< HEAD
=======
### **2. 데이터 일관성**
- **시트명 오타** 수정 (GroupAEnenmy → GroupAEnemy)
- **조건문 로직** 수정 (`if lowered == "A" or "a"` → `if lowered in ["a", "A"]`)

>>>>>>> 7c756fcd429cc63a7a09a22ba8df4f8858839099
### **3. 코드 품질**
- **중복 코드 제거**
- **함수 분리** - 너무 긴 함수들 모듈화
- **타입 힌팅** 추가
- **문서화** 개선

## 📊 **데이터 구조**

### **Google Sheets 구조**
- `char` - 캐릭터 기본 정보
- `BattleGroupA/B` - 전투 참가자 정보
- `GroupAEnemy/B` - 적 정보
- `BattleLogA/B` - 전투 로그
- `BossData` - 보스 정보
- `ShopData` - 상점 정보

## 🚀 **개발 우선순위**

### **Phase 1: 핵심 전투 시스템**
1. 실제 전투 판정 로직 구현
2. HP 관리 시스템 구현
3. 턴 종료 및 진행 로직 완성
4. 승리/패배 조건 구현

### **Phase 2: 스킬 시스템**
1. 직업별 스킬 구현
2. 상태이상 시스템 구현
3. 버프/디버프 관리 시스템
4. 리미트 브레이크 구현

### **Phase 3: 고급 기능**
1. PVP 시스템 구현
2. 보상 및 코인 시스템
3. 관리자 기능 구현
4. 상점 및 인벤토리 시스템

## 💻 **설치 및 실행**

```bash
# 의존성 설치
pip install discord.py gspread oauth2client python-dotenv

# 환경변수 설정 (.env 파일)
moogle_token=YOUR_DISCORD_BOT_TOKEN
test_token=YOUR_TEST_BOT_TOKEN

# 봇 실행
python newnew.py
```

## 📁 **파일 구조**

```
librarian_moogle/
├── newnew.py                 # 메인 봇 파일 및 UI 시스템
├── discord_battle_system.py  # 전투 시스템 코어
├── gspread_manager.py        # Google Sheets 관리
├── job.py                    # 직업 및 스킬 시스템
├── utility.py               # 유틸리티 함수들
├── .env                     # 환경변수
└── README.md               # 이 파일